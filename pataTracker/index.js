/**
* Copyright (C) 2016-2019 Cedric Stoquer
*
* This file is part of the Pixelbox SDK.
*
* This file is subject to the terms and conditions defined in
* file "LICENSE.txt", which is part of this source code package.
*/
var __EXPORT__ = null;
!function(){function t(s,i,e){function n(o,r){if(!i[o]){if(!s[o]){var a=null;if(!r&&a)return a(o,!0);if(h)return h(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var u=i[o]={exports:{}};s[o][0].call(u.exports,function(t){var i=s[o][1][t];return n(i||t)},u,u.exports,t,s,i,e)}return i[o].exports}for(var h=null,o=0;o<e.length;o++)n(e[o]);return n}return t}()({1:[function(t,s,i){s.exports=function(t,s){t.prototype=Object.create(s.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}},{}],2:[function(t,s,i){function e(t){this.color=0,this.steps=[],this.frozen=!1;for(var s=0;s<t;s++){var i=new n(s);this.steps.push(i)}}var n=t("./Step");s.exports=e;var h=e.prototype;h.$15=function(){for(var t=null,s=this.steps.length-1;s>=0;s--){var i=this.steps[s];if(i.$1i){var e=new n(i.index);e.note=-1,e.$1g=i.$1i,e.next=t,i.next=e}else i.next=t;i.$26||(t=i)}},h.$14=function(t){this.color=t.c||0;for(var s=t.s,i=0,e=0;e<this.steps.length;e++)i=this.steps[e].$14(s,i);this.$15()}},{"./Step":4}],3:[function(t,s,i){function e(t,s){this.album=t,this.index=s,this.name="untitled",this.author="",this.infos="",this.bpm=130,this.$k=32,this.speed=4,this.groove=[],this.highlight=16,this.loop=0,this.length=0,this.tracks=[],this.effects=[],this.$t=null;for(var i=t.trackCount,e=0;e<i;e++){var n=new h(this,e);this.tracks.push(n)}}var n=t("./Pattern"),h=t("./Track");s.exports=e;var o=e.prototype;o.$14=function(t){this.name=t.n||"",this.author=t.a||"",this.infos=t.i||"",this.bpm=t.b,this.$k=t.l,this.speed=t.s,this.groove=t.g,this.highlight=t.h,this.loop=t.o||0,this.$t=new n(this.$k),this.$t.frozen=!0;var s=t.t;this.length=0;for(var i=0;i<s.length;i++){var e=this.tracks[i];e.$14(s[i]),this.length=Math.max(this.length,e.sequence.length)}var h=t.e||[];this.effects=[];for(var i=0;i<4;i++){var o=h[i];o?this.effects.push({id:o.i||0,params:o.p||{}}):this.effects.push(null)}}},{"./Pattern":2,"./Track":5}],4:[function(t,s,i){function e(t,s){return _[t]*u.length+_[s]}function n(t,s,i,n){var h=e(t,s);i["fx"+n]=h%c,i["fv"+n]=~~(h/c)}function h(t,s,i,e){this.id=t,this.value=s,this.x=i,this.y=e}function o(t){this.index=t,this.$26=!0,this.next=null,this.note=null,this.inst=null,this.vol=null,this.fx1=null,this.fx2=null,this.fv1=0,this.fv2=0,this.$2n=[],this.$2o=[],this.$1g=0,this.$1i=0}var r=t("../constants"),a=r.$1s,l=t("./encoding"),u=l.$1v,_=l.$25,c=l.$i;s.exports=o;var p=o.prototype;p.$x=function(t,s){if(t===a.$1c)return void(this.$1g=s/256);if(t===a.$1d)return void(this.$1i=s/256);var i=s>>4,e=15&s,n=new h(t,s,i,e);t===a.$2s?this.$2n.push(n):this.$2o.push(n)},p.$1e=function(){this.$26=!(null!==this.note||null!==this.inst||null!==this.vol||null!==this.fx1||null!==this.fx2),this.$2n=[],this.$2o=[],this.$1g=0,this.$1i=0,null!==this.fx2&&this.$x(this.fx2,this.fv2),null!==this.fx1&&this.$x(this.fx1,this.fv1)},p.$14=function(t,s){this.note=null,this.inst=null,this.vol=null,this.fx1=null,this.fx2=null;var i=_[t[s++]],h=1&i,o=i>>1&1,r=i>>2&1,a=i>>3&1,l=i>>4&1;if(h){var u=i>>5&1;u?this.note=-1:this.note=e(t[s++],t[s++])}return o&&(this.inst=_[t[s++]]),r&&(this.vol=_[t[s++]]),a&&n(t[s++],t[s++],this,1),l&&n(t[s++],t[s++],this,2),this.$1e(),s}},{"../constants":13,"./encoding":6}],5:[function(t,s,i){function e(t,s){this.index=s,this.song=t,this.synthId=0,this.patterns=[],this.sequence=[]}var n=t("./Pattern");s.exports=e;var h=e.prototype;h.$2=function(t){var s=this.song.length;if(t>=s){var i=this.song.loop;t=(t-i)%(s-i)+i}if(t>this.sequence.length)return this.song.$t;var e=this.sequence[t];return e===-1?this.song.$t:this.patterns[e]},h.$js=function(){return this.song.album.instruments[this.synthId]},h.$14=function(t){this.synthId=t.y||0,this.sequence=t.s,this.patterns=[];for(var s=t.p,i=this.song.$k,e=0;e<s.length;e++){var h=new n(i);h.$14(s[e]),this.patterns.push(h)}}},{"./Pattern":2}],6:[function(t,s,i){for(var e="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ#$%&'()*+,-~/:;<=>?@[]^_`{|}. !",n={},h=0;h<e.length;h++)n[e[h]]=h;i.$1v=e,i.$25=n,i.$i=32},{}],7:[function(t,s,i){function e(){this.version=0,this.trackCount=8,this.instruments={},this.songs=[],this.samples=[],this.path=""}var n=t("./Song");s.exports=e;var h=e.prototype;h.$14=function(t){var s=t.v||0,i=t.s||[];this.version=s,this.trackCount=t.t,this.songs=[],this.instruments=t.i,this.samples=t.a;for(var e=0;e<i.length;e++){var h=new n(this,e);h.$14(i[e]),this.songs.push(h)}}},{"./Song":3}],8:[function(t,s,i){function e(t,s){this.index=t,this.sequencer=s,this.effector=null,this.params=null,this.buffL=new Float32Array(o),this.buffR=new Float32Array(o)}var n=t("../constants"),h=t("../synths").getEffector,o=n.$h;s.exports=e;var r=e.prototype;r.loadEffect=function(t){if(!t)return void(this.effector=null);this.effector=h(t.id,this.sequencer);var s=t.params;for(var i in s)this.effector[i]=s[i]},r.clearBuffer=function(){if(this.effector)for(var t=0;t<o;t++)this.buffL[t]=0,this.buffR[t]=0},r.process=function(t){this.effector&&this.effector.process(this.buffL,this.buffR,this.sequencer.buffL,this.sequencer.buffR,t)}},{"../constants":13,"../synths":27}],9:[function(t,s,i){function e(t,s){this.index=t,this.sequencer=s,this.synth=null,this.data=null,this.$u=0,this.$1w=null,this.$1f=0,this.output=this.sequencer}var n=t("../synths").getSynth,h=t("../constants"),o=h.$1s;s.exports=e;var r=e.prototype;r.restart=function(t){this.synth&&(this.synth.$27(),this.$u=t||0,this.$1w=this.data.$2(this.$u).steps[0],this.$3())},r.loadData=function(t){this.data=t,this.synth=n(t.synthId,this.sequencer),this.output=this.sequencer,this.restart()},r.$y=function(t){if(t){null!==t.vol&&this.synth.$1q(t.vol),null!==t.inst&&this.synth.$n(this.sequencer.$j(this.index,t.inst));for(var s=0;s<t.$2n.length;s++){var i=t.$2n[s];this.synth.$2t(i.id,i.value,i.x,i.y)}null!==t.note&&(t.note===-1?this.synth.$27():this.synth.$2m(t.note));for(var s=0;s<t.$2o.length;s++){var i=t.$2o[s];i.id===o.$12?this.output=this.sequencer.effects[i.value]||this.sequencer:this.synth.$2t(i.id,i.value,i.x,i.y)}}},r.$3=function(){var t=this.sequencer,s=this.$1w,i=t.$w[s.index%t.$w.length];this.$1f=this.$u*t.$1y+(s.index+s.$1g)*t.$1z+i},r.$b=function(){this.$1w=this.$1w.next,this.$1w||(this.$u+=1,this.$1w=this.data.$2(this.$u).steps[0]),this.$3()},r.$1x=function(t){if(this.synth){var s=this.sequencer.t;this.$1f<=s&&(this.$y(this.$1w),this.$b());for(var i=0,e=s+t;this.$1f<e;){var n=~~(this.$1f-s);n<0&&(n=0),this.synth.$1x(this.output.buffL,this.output.buffR,i,n),i=n,this.$y(this.$1w),this.$b()}this.synth.$1x(this.output.buffL,this.output.buffR,i,t)}}},{"../constants":13,"../synths":27}],10:[function(t,s,i){function e(){this.tracks=[],this.effects=[],this.buffers=[],this.album=null,this.song=null,this.$1z=0,this.$1y=0,this.$w=[0],this.synth=null,this.t=0,this.stopped=!0,this.$1r=null,this.$16=null,this.buffL=null,this.buffR=null,this.effects.push(this);for(var t=0;t<_;t++)this.effects.push(new a(t,this));this.$4=[]}var n=t("./loadAudioBuffer"),h=t("../constants"),o=t("../audioContext"),r=t("./Track"),a=t("./Effect"),l=h.$11,u=h.$h,_=4;s.exports=e;var c=e.prototype;c.$e=function(){if(!this.$16){this.$1r=o.createGain(),this.$1r.connect(o.destination),this.$1r.gain.value=.5;var t=o.createScriptProcessor(u,0,2);t.onaudioprocess=this.onAudioProcess.bind(this),t.connect(this.$1r),this.$16=t}},c.onAudioProcess=function(t){var s,i=t.outputBuffer,e=this.buffL=i.getChannelData(0),n=this.buffR=i.getChannelData(1);for(s=0;s<u;s++)e[s]=0,n[s]=0;for(s=0;s<this.$4.length;s++)this.$4[s].clearBuffer();if(!this.stopped){for(s=0;s<this.tracks.length;s++)this.tracks[s].$1x(u);for(s=0;s<this.$4.length;s++)this.$4[s].process(u);this.t+=u}},c.$13=function(){for(var t=0;t<this.tracks.length;t++){var s=this.tracks[t].synth;s&&s.reset()}},c.play=function(){this.$q(0)},c.$q=function(t){if(this.song){this.t=t*this.$1y;for(var s=0;s<this.tracks.length;s++)this.tracks[s].restart(t);this.stopped=!1}},c.stop=function(){this.stopped=!0,this.$13()},c.$j=function(t,s){var i=this.song.tracks[t].synthId,e=this.album.instruments[i];return e[s%e.length]},c.loadAlbum=function(t,s){this.stop(),this.album=t,this.song=null,this.tracks=[];for(var i=t.trackCount,e=0;e<i;e++){var n=new r(e,this);this.tracks.push(n)}var h=t.samples;this.buffers=[];for(var e=0;e<h.length;e++)this.buffers.push(null),this.loadAudioBufferInIndex(h[e],e)},c.loadAudioBufferInIndex=function(t,s){var i=this.buffers;n(t,function(t,e){return t?void console.error(t):void(i[s]=e.getChannelData(0))})},c.$d=function(t){if(!this.album)return console.error("No album loaded");var s=this.album.songs[t];if(!s)return console.error("No song at index");this.song=s,this.$1b();for(var i=0;i<this.tracks.length;i++){var e=this.tracks[i];e.loadData(s.tracks[i])}for(var i=1;i<this.effects.length;i++){var n=this.effects[i];n.loadEffect(s.effects[i-1])}this.$p(),this.synth=this.tracks[0].synth,this.$13()},c.$p=function(){this.$4=[];for(var t=1;t<this.effects.length;t++){var s=this.effects[t];s.effector&&this.$4.push(s)}},c.$1b=function(){this.$1z=60*l/this.song.bpm/this.song.speed,this.$1y=this.$1z*this.song.$k,this.$v()},c.$v=function(){this.$w=[0];var t=this.song.groove;if(t&&!(t.length<2)){for(var s=0,i=0;i<t.length;i++)s+=t[i];for(var e=s/t.length,n=t[0],i=1;i<t.length;i++){var h=(n-e*i)/e*this.$1z;this.$w.push(h),n+=t[i]}}}},{"../audioContext":12,"../constants":13,"./Effect":8,"./Track":9,"./loadAudioBuffer":11}],11:[function(t,s,i){function e(t){this.uri=t,this.buffer=null,this.error=null,this.loading=!1,this.onLoad=[]}var n=t("../audioContext"),h={};e.prototype.load=function(t){return this.error||this.buffer?t(this.error,this.buffer):(this.onLoad.push(t),void(this.loading||this.initiateLoad()))},e.prototype.initiateLoad=function(){this.loading=!0;var t=new XMLHttpRequest;t.responseType="arraybuffer";var s=this;t.onreadystatechange=function(){if(4===~~t.readyState)return 200!==~~t.status&&0!==~~t.status?s.completeLoad("xhrError:"+t.status):void n.decodeAudioData(t.response,function(t){return s.completeLoad(null,t)},s.completeLoad.bind(s))},t.open("GET",this.uri,!0),t.send()},e.prototype.completeLoad=function(t,s){this.buffer=s,this.error=t;for(var i=0;i<this.onLoad.length;i++)this.onLoad[i](t,s);this.onLoad=[]},s.exports=function(t,s){var i=h[t];i||(i=h[t]=new e(t)),i.load(s)}},{"../audioContext":12}],12:[function(t,s,i){var e=window.AudioContext,n=new e;s.exports=n},{}],13:[function(t,s,i){i.$h=2048,i.$11=44100,i.$r=i.$11/64,i.$1s={$1t:0,$23:1,$24:2,$2v:3,$2s:4,$8:5,$g:6,$1c:7,$1d:8,$12:9},i.$1u=1,i.$5=2,i.$9=32,i.$6=4,i.TAU=2*Math.PI},{}],14:[function(t,s,i){function e(t){return 440*Math.pow(2,(t-69)/12)}for(var n=[],h=0;h<128;h++)n.push(e(h));i.$a=n,i.$1h=function(t){t<0&&(t=0),t>127&&(t=127);var s=~~t,i=t-s,e=n[s],h=n[s+1];return e+i*(h-e)}},{}],15:[function(t,s,i){var e=t("./audioContext"),n=t("./Album"),h=t("./Sequencer"),o=new n,r=new h;r.$e();var a={};__EXPORT__={context:e,output:r.$1r,loadData:function(t){o.$14(t),r.loadAlbum(o),a={};for(var s=0;s<o.songs.length;s++){var i=o.songs[s];a[i.name]=s}},playSong:function(t){a[t]&&(t=a[t]),r.$d(~~t),r.play()},stop:function(){r.stop()},$1q:function(t){r.$1r.gain.value=Math.max(0,Math.min(t,1))}}},{"./Album":7,"./Sequencer":10,"./audioContext":12}],16:[function(t,s,i){function e(){this._time=11025,this.f=.4,this.c=.6,this.$2k=new Float32Array(n),this.$21=0,this._filterState=0}var n=44100;s.exports=e;var h=e.prototype;e.getDefaultParams=function(){return{t:.25,f:.4,c:.6}},h.process=function(t,s,i,e,h){for(var o=0;o<h;o++){var r=this.$2k[this.$21]*this.f;this._filterState=r*this.c+this._filterState*(1-this.c),r=t[o]+this._filterState,this.$2k[(this.$21+this._time)%n]=r,this.$21+=1,this.$21>=n&&(this.$21=0),i[o]+=r,e[o]+=r}},Object.defineProperty(h,"t",{set:function(t){this._time=Math.max(100,~~(t*n))}})},{}],17:[function(t,s,i){function e(t){this.synth=t,this.$2p=0,this.$2l=g,this.$2c=0,this.out=0,this.instrument=null}function n(){this.note=0,this.volume=0,this.playing=!1,this.$2q=0,this.$m=0,this.$2w=0,this.instrument=null,this.$1m=null,this.$1p=0,this.$1n=0,this.$1o=0,this.$2e=0,this.$2f=0,this.$2g=0,this.$2j=0,this.$2h=0,this.$2i=0,this.$19=!1,this.$2d=0,this.$1l=null,this.$20=0,this._damping=!1,this._dampVal=0,this._lastOut=0,this.$1j=[new e(this),new e(this),new e(this),new e(this)],this.$n(this.$1())}var h=t("../constants"),o=t("../noteUtils"),r=h.$1s,a=h.$11,l=a/60,u=(h.$1u,h.TAU),_=h.$5,c=h.$6,p=h.$9,f=4,d=3,m=2,v=1,g=0,b=e.prototype;b.$n=function(t){this.instrument=t},b.$28=function(){this.$2c=0,this.$2l=f},b.$1x=function(){switch(this.$2l){case g:return;case m:break;case f:this.$2c+=this.instrument.a/64,this.$2c>=1&&(this.$2c=1,this.$2l=d);break;case d:this.$2c-=this.instrument.d/64,this.$2c<=this.instrument.s&&(this.$2c=this.instrument.s,1===this.synth.instrument.c?this.$2l=v:this.$2l=m);break;case v:this.$2c-=this.instrument.r/64,this.$2c<=0&&(this.$2c=0,this.$2l=g,this.out=0)}var t=this.synth.$1j,s=this.instrument.c,i=0;i+=s[0]*t[0].out,i+=s[1]*t[1].out,i+=s[2]*t[2].out,i+=s[3]*t[3].out,this.$2p+=this.synth.$2q*this.instrument.m,this.$2p>=1&&(this.$2p=this.$2p%1),this.out=this.$2c*Math.sin(u*(this.$2p+i))},s.exports=n;var P=n.prototype;P.$1=function(){return{n:"",l:{},p:0,c:1,o:[{m:1,a:.25,d:.00225,s:.5,r:.00225,c:[0,0,0,0],v:0},{m:1,a:.25,d:.00225,s:.5,r:.00225,c:[0,0,0,0],v:0},{m:1,a:.25,d:.00225,s:.5,r:.00225,c:[0,0,0,0],v:0},{m:1,a:.25,d:.00225,s:.5,r:.00225,c:[0,0,0,0],v:1}]}},P.$n=function(t){this.instrument=t,this.$1j[0].$n(t.o[0]),this.$1j[1].$n(t.o[1]),this.$1j[2].$n(t.o[2]),this.$1j[3].$n(t.o[3])},P.reset=function(){this.$27(),this.$1q(15),this.$19=!1,this.$1l=null,this.$20=0,this.$2g=0,this.$2i=0,this.$17(),this.$18()},P.$2m=function(t){null!==this.$1m?(this.note+=this.$1n,this.$1o=0,this.$1n=t-this.note,this.$1p=this.$1n/(this.$1m+1)/_,this.$1m=null):(this.note=t,this.$1n=0,this.$1p=0,this.$1o=0),this.playing=!0,this.$m=0,this.$2d=0,this.$1j[0].$28(),this.$1j[1].$28(),this.$1j[2].$28(),this.$1j[3].$28(),this.$17(),this._damping=!1},P.$27=function(){this.playing&&(0===this.instrument.c?(this.$1j[0].$2l=v,this.$1j[1].$2l=v,this.$1j[2].$2l=v,this.$1j[3].$2l=v):(this.playing=!1,this._damping=!0,this._dampVal=this._lastOut))},P.$17=function(){var t=0;this.$2f>0&&(t=this.$2g*Math.sin(this.$2e*u));var s=this.note+this.instrument.p+this.$20+this.$1o+t;this.$2q=o.$1h(s)/a},P.$18=function(){var t=1;this.$2h>0&&(t=1-this.$2i*(Math.sin(this.$2j*u)+1)),this.$2w=this.volume*t},P.$c=function(){var t=!1,s=!1;this.$19&&(this.$2d=(this.$2d+1)%this.$1l.length,this.$20=this.$1l[this.$2d],s=!0),0!==this.$1p&&(this.$1o+=this.$1p,s=!0,(this.$1p>0&&this.$1o>=this.$1n||this.$1p<0&&this.$1o<=this.$1n)&&(this.$1o=this.$1n,this.$1p=0)),this.$2f>0&&(this.$2e+=this.$2f,this.$2e>1&&(this.$2e-=1),s=!0),this.$2h>0&&(this.$2j+=this.$2h,this.$2j>1&&(this.$2j-=1),t=!0),s&&this.$17(),t&&this.$18()},P.$1q=function(t){this.volume=t/40,this.$18()},P.$2t=function(t,s,i,e){var n=!1,h=!1;switch(t){case r.$1t:this.$20=0,this.$2d=0,0===s?(this.$19=!1,this.$1l=null,n=!0):(this.$19=!0,this.$1l=0===e?[0,i]:[0,i,e]);break;case r.$24:this.$2f=i/64,this.$2g=e/16,0===e&&(n=!0);break;case r.$23:this.$2h=i/64,this.$2i=e/p,h=!0;break;case r.$2s:this.$1m=s/c;break;case r.$g:this.note+=this.$1n,this.$1o=0,this.$1n=e,this.$1p=e/(i+1)/_;break;case r.$8:this.note+=this.$1n,this.$1o=0,this.$1n=-e,this.$1p=-e/(i+1)/_}n&&this.$17(),h&&this.$18()},P.$1x=function(t,s,i,e){if(this._damping){for(var n=i;n<e;n++)if(this._dampVal*=.98,t[n]+=this._dampVal,s[n]+=this._dampVal,this._dampVal>-.01&&this._dampVal<.01)return void(this._damping=!1)}else if(this.playing){for(var n=i;n<e;n++){if(++this.$m>=l){if(this.$m-=l,this.$1j[0].$2l===g&&this.$1j[1].$2l===g&&this.$1j[2].$2l===g&&this.$1j[3].$2l===g)return void(this.playing=!1);this.$c()}this.$1j[0].$1x(),this.$1j[1].$1x(),this.$1j[2].$1x(),this.$1j[3].$1x();var h=0;h+=this.$1j[0].instrument.v*this.$1j[0].out,h+=this.$1j[1].instrument.v*this.$1j[1].out,h+=this.$1j[2].instrument.v*this.$1j[2].out,h+=this.$1j[3].instrument.v*this.$1j[3].out,h*=this.$2w,t[n]+=h,s[n]+=h}this._lastOut=h}}},{"../constants":13,"../noteUtils":14}],18:[function(t,s,i){function e(t){this.feedback=0,this.$2k=new Float32Array(t),this._bufsize=t,this._index=0,this._filtered=0,this._damp1=0,this._damp2=0}function n(t){this.$2k=new Float32Array(t),this._bufsize=t,this._index=0}function h(){this._roomSize=0,this._roomSize1=0,this._damp=0,this._damp1=0,this._wet=0,this._wet1=0,this._wet2=0,this._dry=0,this._width=0,this.combL=[],this.combR=[],this.allpassL=[],this.allpassR=[];for(var t=0;t<l;t++)this.combL.push(new e(_[t])),this.combR.push(new e(_[t]+a));for(var s=0;s<u;s++)this.allpassL.push(new n(c[s])),this.allpassR.push(new n(c[s]+a))}var o=e.prototype;o.setDamp=function(t){this._damp1=t,this._damp2=1-t},o.mute=function(){for(var t=0;t<this._bufsize;t++)this.$2k[t]=0},o.process=function(t){var s=this.$2k[this._index];return this._filtered=s*this._damp2+this._filtered*this._damp1,this.$2k[this._index]=t+this._filtered*this.feedback,++this._index>=this._bufsize&&(this._index=0),s};var r=n.prototype;r.mute=function(){for(var t=0;t<this._bufsize;t++)this.$2k[t]=0},r.process=function(t){var s=this.$2k[this._index];return this.$2k[this._index]=t+.5*s,++this._index>=this._bufsize&&(this._index=0),s-t};var a=23,l=8,u=4,_=[1116,1188,1277,1356,1422,1491,1557,1617],c=[556,441,341,225];s.exports=h;var p=h.prototype;h.getDefaultParams=function(){return{d:.8,w:.3,z:.8,a:.5,i:.8}},p.process=function(t,s,i,e,n){for(var h,o=0;o<n;o++){var r=0,a=0;for(h=0;h<l;h++)r+=this.combL[h].process(t[o]),a+=this.combR[h].process(s[o]);for(h=0;h<u;h++)r=this.allpassL[h].process(r),a=this.allpassR[h].process(a);i[o]+=r*this._wet1+a*this._wet2+t[o]*this._dry,e[o]+=a*this._wet1+r*this._wet2+s[o]*this._dry}},p.mute=function(){for(var t=0;t<l;t++)this.combL[t].mute(),this.combR[t].mute();for(var t=0;t<u;t++)this.allpassL[t].mute(),this.allpassR[t].mute()},p.update=function(){this._wet1=this._wet*(this._width/2+.5),this._wet2=this._wet*((1-this._width)/2),this._roomSize1=this._roomSize,this._damp1=this._damp;for(var t=0;t<l;t++)this.combL[t].feedback=this._roomSize1,this.combR[t].feedback=this._roomSize1,this.combL[t].setDamp(this._damp1),this.combR[t].setDamp(this._damp1)},Object.defineProperty(p,"d",{set:function(t){this._dry=1*t}}),Object.defineProperty(p,"w",{set:function(t){this._wet=.06*t,this.update()}}),Object.defineProperty(p,"z",{set:function(t){this._roomSize=.28*t+.7,this.update()}}),Object.defineProperty(p,"a",{set:function(t){this._damp=.4*t,this.update()}}),Object.defineProperty(p,"i",{set:function(t){this._width=t,this.update()}})},{}],19:[function(t,s,i){function e(){this.note=0,this.volume=0,this.playing=!1,this.$m=0,this.$2w=l,this.$29=0,this.$2a=0,this.$1k=1,this.$2b=0,this.$2u=c[0],this.$2j=0,this.$2h=0,this.$2i=0,this.$1a=new h(1,15),this.$o=new h(0,1),this.$10=new h(0,1)}var n=t("../constants"),h=t("./TableEnvelope"),o=n.$1s,r=n.$11,a=r/60,l=1.4,u=2*Math.PI,_=[.01,.02,.04,.053,.08,.105,.15,.2,.25,.3,.35,.4,.45,.5,.7,.9],c=[8192,256,6144,4480];s.exports=e;var p=e.prototype;p.$1=function(){return{n:""}},p.$n=function(t){this.$1a.set(t.a),this.$o.set(t.p),this.$10.set(t.d)},p.reset=function(){this.$27(),this.$1q(15),this.$29=0,this.$2i=0,this.$17(),this.$18()},p.$2m=function(t){this.note=t,this.$m=0,this.$1a.$2r(),this.$o.$2r(),this.$10.$2r(),this.$17(),this.$18(),this.playing=!0},p.$27=function(){this.playing=!1},p.$1q=function(t){this.volume=t/30,this.$18()},p.$2t=function(t,s,i,e){var n=!1;switch(t){case o.$23:this.$2h=i/64,this.$2i=e/32,n=!0;break;case o.$2v:this.$2u=c[s%c.length]}n&&this.$18()},p.$18=function(){var t=1;this.$2h>0&&(t=1-this.$2i*(Math.sin(this.$2j*u)+1)),this.$2w=l*this.volume*t,this.$2w*=this.$1a.value},p.$17=function(){var t=~~(this.note+this.$o.value);this.$2a=_[t%16]},p.$c=function(){var t=!1,s=!1;this.$2h>0&&(this.$2j+=this.$2h,this.$2j>1&&(this.$2j-=1),t=!0),this.$1a.enabled&&this.$1a.clock()&&(t=!0),this.$o.enabled&&this.$o.clock()&&(s=!0),this.$10.enabled&&this.$10.clock()&&(this.$2u=c[~~this.$10.value%c.length]),s&&this.$17(),t&&this.$18()},p.$1x=function(t,s,i,e){if(this.playing)for(var n=i;n<e;n++){if(++this.$m>=a&&(this.$m-=a,this.$c()),this.$29+=this.$2a,this.$29>1){this.$29=this.$29%1;var h=!(16384&this.$1k)^!(this.$1k&this.$2u);this.$1k=32767&(this.$1k<<1|h),this.$2b=(16384&this.$1k)>>14}var o=(this.$2b-.5)*this.$2w;t[n]+=o,s[n]+=o}}},{"../constants":13,"./TableEnvelope":25}],20:[function(t,s,i){function e(){o.call(this),this.$2w=.25,this.$2u=.25,this.$10=new h(0,1)}for(var n=t("../constants"),h=t("./TableEnvelope"),o=t("./SimpleOscillator"),r=t("pixelbox/inherits"),a=n.$11,l=a/60,u=[1/8,.25,.5,.75],_=1;_<63;_++)u.push(_/64);r(e,o),s.exports=e;var c=e.prototype;c.$n=function(t){o.prototype.$n.call(this,t),this.$10.set(t.d)},c.$2m=function(t){o.prototype.$2m.call(this,t),this.$10.$2r()},c.$1q=function(t){this.volume=t/60,this.$18()},c._updateDuty=function(t){this.$2u=u[t%u.length]},c.$c=function(){o.prototype.$c.call(this),this.$10.enabled&&this.$10.clock()&&(this.$2u=u[~~this.$10.value])},c.$1x=function(t,s,i,e){if(this.playing)for(var n=i;n<e;n++){++this.$m>=l&&(this.$m-=l,this.$c()),this.$29+=this.$2a,this.$29>1&&(this.$29=this.$29%1);var h=this.$29>this.$2u?this.$2w:-this.$2w;t[n]+=h,s[n]+=h}}},{"../constants":13,"./SimpleOscillator":24,"./TableEnvelope":25,"pixelbox/inherits":1}],21:[function(t,s,i){function e(){n.call(this),this._damping=!1,this._dampVal=0}var n=t("./SimpleOscillator"),h=t("../constants"),o=t("pixelbox/inherits"),r=h.$11,a=r/60,l=[0,.12,.25,.37,.5,.62,.75,.87,.87,.75,.62,.5,.37,.25,.12,0,-.12,-.25,-.37,-.5,-.62,-.75,-.87,-1,-1,-.87,-.75,-.62,-.5,-.37,-.25,-.12];o(e,n),s.exports=e;var u=e.prototype;u.$2m=function(t){n.prototype.$2m.call(this,t),this._damping=!1},u.$27=function(){this.playing&&(this._damping=!0,this._dampVal=l[~~(32*this.$29)]*this.$2w),this.playing=!1},u.$1x=function(t,s,i,e){if(this._damping){for(var n=i;n<e;n++)if(this._dampVal*=.98,t[n]+=this._dampVal,s[n]+=this._dampVal,this._dampVal>-.01&&this._dampVal<.01)return this._damping=!1,void(this.$29=0)}else if(this.playing)for(var n=i;n<e;n++){++this.$m>=a&&(this.$m-=a,this.$c()),this.$29+=this.$2a,this.$29>1&&(this.$29=this.$29%1);var h=l[~~(32*this.$29)]*this.$2w;t[n]+=h,s[n]+=h}}},{"../constants":13,"./SimpleOscillator":24,"pixelbox/inherits":1}],22:[function(t,s,i){function e(t){this._sequencer=t,this.$2k=null,this._instrument=this.$1(),this.note=0,this.volume=0,this.playing=!1,this.$21=0,this.$22=0,this.$f=0,this.$m=0,this.$2w=1,this.$1m=null,this.$1p=0,this.$1n=0,this.$1o=0,this.$2e=0,this.$2f=0,this.$2g=0,this.$2j=0,this.$2h=0,this.$2i=0,this.$2l=g,this.$2c=0}var n=t("../constants"),h=t("../noteUtils"),o=(n.$1u,n.$1s),r=n.$11,a=r/60,l=h.$a[60],u=n.TAU,_=n.$5,c=n.$6,p=n.$9,f=4,d=3,m=2,v=1,g=0;s.exports=e;var b=e.prototype;b.$1=function(){return{n:"",a:0,s:0,e:0,l:0,p:0,v:[1,1,1,1,0]}},b.$n=function(t){this._instrument=t;var s=t.a||0;this.$2k=this._sequencer.buffers[s],this.$21=t.s},b.reset=function(){this.playing=!1,this.$1q(15),this.$17(),this.$18()},b.$2m=function(t){null!==this.$1m?(this.note+=this.$1n,this.$1o=0,this.$1n=t-this.note,this.$1p=this.$1n/(this.$1m+1)/_,this.$1m=null):(this.note=t,this.$1n=0,this.$1p=0,this.$1o=0),this.$m=0,this.$21=this._instrument.s,this.$17(),this.$18(),this.$2c=0,this.$2l=f,this.$2k&&(this.playing=!0)},b.$27=function(){0===this._instrument.v[4]?this.$2l=v:this.playing=!1},b.$1q=function(t){this.volume=t/20,this.$18()},b.$2t=function(t,s,i,e){var n=!1,h=!1;switch(t){case o.$24:this.$2f=i/64,this.$2g=e/16,0===e&&(n=!0);break;case o.$23:this.$2h=i/64,this.$2i=e/p,h=!0;break;case o.$2s:this.$1m=s/c;break;case o.$g:this.note+=this.$1n,this.$1o=0,this.$1n=e,this.$1p=e/(i+1)/_;break;case o.$8:this.note+=this.$1n,this.$1o=0,this.$1n=-e,this.$1p=-e/(i+1)/_}n&&this.$17(),h&&this.$18()},b.$18=function(){var t=1;this.$2h>0&&(t=1-this.$2i*(Math.sin(this.$2j*u)+1)),this.$2w=this.volume*t},b.$17=function(){var t=0;this.$2f>0&&(t=this.$2g*Math.sin(this.$2e*u));var s=this.note+this._instrument.p+this.$1o+t;this.$22=h.$1h(s)/l},b.$c=function(){var t=!1,s=!1;0!==this.$1p&&(this.$1o+=this.$1p,s=!0,(this.$1p>0&&this.$1o>=this.$1n||this.$1p<0&&this.$1o<=this.$1n)&&(this.$1o=this.$1n,this.$1p=0)),this.$2f>0&&(this.$2e+=this.$2f,this.$2e>1&&(this.$2e-=1),s=!0),this.$2h>0&&(this.$2j+=this.$2h,this.$2j>1&&(this.$2j-=1),t=!0),s&&this.$17(),t&&this.$18()},b.$7=function(){if(this.$2l!==g){var t=this._instrument.v;switch(this.$2l){case m:break;case f:this.$2c+=t[0],this.$2c>=1&&(this.$2c=1,this.$2l=d);break;case d:this.$2c-=t[1],this.$2c<=t[2]&&(this.$2c=t[2],1===t[4]?this.$2l=v:this.$2l=m);break;case v:this.$2c-=t[3],this.$2c<=0&&(this.$2c=0,this.$2l=g,this.playing=!1)}}},b.$1x=function(t,s,i,e){if(this.playing)for(var n=i;n<e;n++){if(++this.$f>=64&&(this.$f=0,this.$7()),++this.$m>=a&&(this.$m-=a,this.$c()),this.$21+=this.$22,this.$21>=this._instrument.e){if(0===this._instrument.l)return void(this.playing=!1);this.$21-=this._instrument.l}var h=this.$2k[~~this.$21]*this.$2c*this.$2w;t[n]+=h,s[n]+=h}}},{"../constants":13,"../noteUtils":14}],23:[function(t,s,i){function e(){n.call(this)}var n=t("./SimpleOscillator"),h=t("../constants"),o=t("pixelbox/inherits"),r=h.$11,a=r/60;o(e,n),s.exports=e,e.prototype.$1x=function(t,s,i,e){if(this.playing)for(var n=i;n<e;n++){++this.$m>=a&&(this.$m-=a,this.$c()),this.$29+=this.$2a,this.$29>1&&(this.$29=this.$29%1);var h=(this.$29-.5)*this.$2w;t[n]+=h,s[n]+=h}}},{"../constants":13,"./SimpleOscillator":24,"pixelbox/inherits":1}],24:[function(t,s,i){function e(){this._instrument=null,this.note=0,this.volume=0,this.playing=!1,this.$m=0,this.$2w=u,this.$29=0,this.$2a=0,this.$1m=null,this.$1p=0,this.$1n=0,this.$1o=0,this.$2e=0,this.$2f=0,this.$2g=0,this.$2j=0,this.$2h=0,this.$2i=0,this.$19=!1,this.$2d=0,this.$1l=null,this.$20=0,this.$1a=new o(1,15),this.$o=new o(0,1),this.$z=new o(0,16)}var n=t("../constants"),h=t("../noteUtils"),o=t("./TableEnvelope"),r=n.$1s,a=n.$11,l=n.TAU,u=n.$1u,_=n.$5,c=n.$6,p=n.$9;s.exports=e;var f=e.prototype;f.$1=function(){return{n:""}},f.$n=function(t){this._instrument=t,this.$1a.set(t.a),this.$o.set(t.p),this.$z.set(t.t)},f.reset=function(){this.$27(),this.$1q(15),this.$19=!1,this.$1l=null,this.$20=0,this.$2g=0,this.$2i=0,this.$17(),this.$18()},f.$2m=function(t){null!==this.$1m?(this.note+=this.$1n,this.$1o=0,this.$1n=t-this.note,this.$1p=this.$1n/(this.$1m+1)/_,this.$1m=null):(this.note=t,this.$1n=0,this.$1p=0,this.$1o=0),this.$m=0,this.$2d=0,this.$1a.$2r(),this.$o.$2r(),this.$z.$2r(),this.$17(),this.$18(),this.playing=!0},f.$27=function(){this.playing=!1,this.$1m=null},f.$1q=function(t){this.volume=t/30,this.$18()},f.$2t=function(t,s,i,e){var n=!1,h=!1;switch(t){case r.$1t:this.$20=0,this.$2d=0,0===s?(this.$19=!1,this.$1l=null,n=!0):(this.$19=!0,this.$1l=0===e?[0,i]:[0,i,e]);break;case r.$24:this.$2f=i/64,this.$2g=e/16,0===e&&(n=!0);break;case r.$23:
this.$2h=i/64,this.$2i=e/p,h=!0;break;case r.$2s:this.$1m=s/c;break;case r.$g:this.note+=this.$1n,this.$1o=0,this.$1n=e,this.$1p=e/(i+1)/_;break;case r.$8:this.note+=this.$1n,this.$1o=0,this.$1n=-e,this.$1p=-e/(i+1)/_;break;case r.$2v:this._updateDuty(s)}n&&this.$17(),h&&this.$18()},f._updateDuty=function(t){},f.$18=function(){var t=1;this.$2h>0&&(t=1-this.$2i*(Math.sin(this.$2j*l)+1)),this.$2w=u*this.volume*t,this.$2w*=this.$1a.value},f.$17=function(){var t=0;this.$2f>0&&(t=this.$2g*Math.sin(this.$2e*l));var s=this.note+this.$20+this.$1o+this.$o.value+this.$z.value+t;this.$2a=h.$1h(s)/a},f.$c=function(){var t=!1,s=!1;this.$19&&(this.$2d=(this.$2d+1)%this.$1l.length,this.$20=this.$1l[this.$2d],s=!0),0!==this.$1p&&(this.$1o+=this.$1p,s=!0,(this.$1p>0&&this.$1o>=this.$1n||this.$1p<0&&this.$1o<=this.$1n)&&(this.$1o=this.$1n,this.$1p=0)),this.$2f>0&&(this.$2e+=this.$2f,this.$2e>1&&(this.$2e-=1),s=!0),this.$2h>0&&(this.$2j+=this.$2h,this.$2j>1&&(this.$2j-=1),t=!0),this.$1a.enabled&&this.$1a.clock()&&(t=!0),this.$o.enabled&&this.$o.clock()&&(s=!0),this.$z.enabled&&this.$z.clock()&&(s=!0),s&&this.$17(),t&&this.$18()},f.$1x=function(t,s,i,e){}},{"../constants":13,"../noteUtils":14,"./TableEnvelope":25}],25:[function(t,s,i){function e(t,s){this._playing=!1,this._pos=0,this.min=t,this.max=s,this.data=null,this.table=null,this.enabled=!1,this.value=this.min}s.exports=e;var n=e.prototype;n.set=function(t){if(!t)return this.enabled=!1,this.data=null,this.table=null,void(this.value=this.min);var s=t.t||null;this.data=t,this.enabled=s&&s.length&&!0,this.table=s,this.value=s?s[0]/this.max:this.min},n.clock=function(){return!!this._playing&&(this._pos+=1,this._pos>=this.table.length&&(0===this.data.l?(this._pos=this.table.length-1,this._playing=!1):this._pos-=this.data.l),this.value=this.table[this._pos]/this.max,!0)},n.$2r=function(){this.enabled&&(this._playing=!0,this._pos=0,this.value=this.table[0]/this.max)}},{}],26:[function(t,s,i){function e(){n.call(this),this._damping=!1,this._dampVal=0,this.$n(this.$1())}var n=t("./SimpleOscillator"),h=t("../constants"),o=t("pixelbox/inherits"),r=h.$11,a=r/60;o(e,n),s.exports=e;var l=e.prototype;l.$1=function(){return{n:"",w:{t:[0,1,2,3,4,5,6,7,8,7,6,5,4,3,2,1,0,-1,-2,-3,-4,-5,-6,-7,-8,-7,-6,-5,-4,-3,-2,-1]}}},l.$2m=function(t){n.prototype.$2m.call(this,t),this._damping=!1},l.$27=function(){this.playing&&(this._damping=!0,this._dampVal=this._instrument.w.t[~~(32*this.$29)]*this.$2w),this.playing=!1},l.$1q=function(t){this.volume=t/256,this.$18()},l.$1x=function(t,s,i,e){if(this._damping){for(var n=i;n<e;n++)if(this._dampVal*=.98,t[n]+=this._dampVal,s[n]+=this._dampVal,this._dampVal>-.01&&this._dampVal<.01)return this._damping=!1,void(this.$29=0)}else if(this.playing)for(var n=i;n<e;n++){++this.$m>=a&&(this.$m-=a,this.$c()),this.$29+=this.$2a,this.$29>1&&(this.$29=this.$29%1);var h=this._instrument.w.t[~~(32*this.$29)]*this.$2w;t[n]+=h,s[n]+=h}}},{"../constants":13,"./SimpleOscillator":24,"pixelbox/inherits":1}],27:[function(t,s,i){var e=t("./NesPulse"),n=t("./NesNoise"),h=t("./NesTriangle"),o=t("./Wavetable"),r=t("./Sawtooth"),a=t("./Sampler"),l=t("./FM"),u=t("./FreeVerb"),_=t("./Delay"),c=[null,e,h,n,r,o,a,l,null,null],p=[null,u,_];i.getSynth=function(t,s){if(!t)return null;var i=c[t];if(!i)return null;var e=new i(s);return e},i.getEffector=function(t,s){if(!t)return null;var i=p[t];if(!i)return null;var e=new i;return e},i.$s=p},{"./Delay":16,"./FM":17,"./FreeVerb":18,"./NesNoise":19,"./NesPulse":20,"./NesTriangle":21,"./Sampler":22,"./Sawtooth":23,"./Wavetable":26}]},{},[15]);
module.exports = __EXPORT__;
